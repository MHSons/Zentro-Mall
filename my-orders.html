<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Order History ‚Äì ZentroMall</title>
  <link rel="icon" href="logo.png">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .status-complete { color: #10b981; }
    .status-pending { color: #f59e0b; }
    .order-card:hover { box-shadow: 0 0 30px rgba(252, 211, 77, 0.5); }
    .copy-tracking { cursor: pointer; text-decoration: underline; }
  </style>
</head>
<body class="bg-gradient-to-br from-purple-900 via-indigo-900 to-black text-white min-h-screen p-6">

  <div class="max-w-4xl mx-auto">
    <div class="text-center mb-12">
      <h1 class="text-6xl font-extrabold bg-clip-text text-transparent bg-gradient-to-r from-yellow-400 to-pink-500">
        Your Orders
      </h1>
      <p class="text-2xl mt-4 opacity-90">Enter your phone number</p>
    </div>

    <!-- Phone Input -->
    <div class="bg-gray-800 rounded-3xl p-8 shadow-2xl mb-12">
      <div class="flex flex-col md:flex-row gap-4">
        <input type="tel" id="phoneInput" placeholder="0300 1234567" 
               class="flex-1 p-6 rounded-xl bg-gray-700 text-xl text-left dir-ltr text-center font-bold">
        <button onclick="checkOrders()" 
                class="bg-gradient-to-r from-green-600 to-emerald-600 px-10 py-6 rounded-xl text-2xl font-bold hover:scale-105 transition shadow-lg">
          Check Orders
        </button>
      </div>
      <p class="text-center mt-4 text-gray-400">Use the phone number you placed orders with</p>
    </div>

    <!-- Orders List -->
    <div id="orderList" class="space-y-8"></div>
  </div>

  <script src="main.js"></script>
  <script>
    function checkOrders() {
      const phone = document.getElementById("phoneInput").value.trim().replace(/[-\s]/g, '');
      if (!phone || phone.length < 10) {
        alert("Please enter a valid phone number");
        return;
      }

      const userOrders = orders
        .filter(o => o.customer.phone && o.customer.phone.replace(/[-\s]/g, '').includes(phone))
        .sort((a,b) => new Date(b.date) - new Date(a.date)); // newest first

      const container = document.getElementById("orderList");

      if (userOrders.length === 0) {
        container.innerHTML = `
          <div class="bg-gray-800 rounded-3xl p-16 text-center shadow-2xl">
            <p class="text-4xl text-gray-500 mb-6">No orders found üòî</p>
            <p class="text-xl text-gray-400">Check your phone number or place a new order</p>
          </div>`;
        return;
      }

      container.innerHTML = userOrders.map((o, i) => {
        const itemsList = o.items.map(it => {
          const product = products.find(p => p.id === it.id);
          const subtotal = product ? product.price * it.qty : 0;
          return `‚Ä¢ ${it.name || "Unknown"} √ó ${it.qty} = <strong>${formatPrice(subtotal)}</strong>`;
        }).join("<br>");

        return `
          <div class="bg-gray-800 rounded-3xl p-8 shadow-2xl order-card transition">
            <div class="flex justify-between items-start mb-6">
              <div>
                <p class="text-3xl font-bold text-yellow-400">Order #${orders.indexOf(o) + 1}</p>
                <p class="text-lg text-gray-400 mt-2">Date: ${o.date}</p>
              </div>
              <div class="text-right">
                <p class="text-4xl font-extrabold text-green-400">${formatPrice(o.total)}</p>
                <p class="text-sm text-gray-500">Total Amount</p>
              </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-lg">
              <div>
                <p class="font-bold mb-2">Items:</p>
                <div class="text-gray-300 leading-relaxed">${itemsList}</div>
              </div>
              <div class="space-y-4">
                <p>Status: <span class="${o.status === 'complete' ? 'status-complete' : 'status-pending'} font-bold text-2xl">
                  ${o.status === 'complete' ? 'Delivered ‚úì' : 'Pending ‚è≥'}
                </span></p>
                <p>Tracking ID: 
                  <span class="copy-tracking font-bold text-cyan-400 text-xl" onclick="navigator.clipboard.writeText('${o.tracking_id || ''}'); alert('Copied!')">
                    ${o.tracking_id || 'Not Available Yet'}
                  </span>
                </p>
                ${o.tracking_id ? `<p class="text-sm text-gray-400">Check via TCS or Leopard app</p>` : ''}
              </div>
            </div>

            <div class="mt-6 pt-6 border-t border-gray-700 text-center">
              <p class="text-gray-400">
                Any questions? <a href="https://wa.me/923001234567" target="_blank" class="text-green-400 font-bold underline">Contact via WhatsApp</a>
              </p>
            </div>
          </div>`;
      }).join("");
    }

    document.getElementById("phoneInput").addEventListener("keyup", function(e) {
      if (e.key === "Enter") checkOrders();
    });
  </script>
</body>
</html>
